<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="Pandas学习, Jay&#39;s Blog">
    <meta name="description" content="Pandas序列与数据框的构造
Pandas 模块的核心操作对象就是序列（Series）和数据框（DataFrame）。序列可以理解为数据集中的一个字段，数据框是指含有至少两个字段（或序列）的数据集。

构造序列
构造一个序列可以使用如下方">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>Pandas学习 | Jay&#39;s Blog</title>
    <link rel="icon" type="image/png" href="/favicon.png">
    


    <!-- bg-cover style     -->



<link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
<link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
<link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
<link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
<link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
<link rel="stylesheet" type="text/css" href="/css/matery.css">
<link rel="stylesheet" type="text/css" href="/css/my.css">
<link rel="stylesheet" type="text/css" href="/css/dark.css" media="none" onload="if(media!='all')media='all'">




    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
    <link rel="stylesheet" href="/css/post.css">




    



    <script src="/libs/jquery/jquery-3.6.0.min.js"></script>

    <script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>

<meta name="generator" content="Hexo 7.2.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <span class="logo-span">Jay&#39;s Blog</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/galleries" class="waves-effect waves-light">
      
      <i class="fas fa-image" style="zoom: 0.6;"></i>
      
      <span>相册</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
  <li>
    <a href="javascript:;" class="waves-effect waves-light" onclick="switchNightMode()" title="深色/浅色模式" >
      <i id="sum-moon-icon" class="fas fa-sun" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <div class="logo-name">Jay&#39;s Blog</div>
        <div class="logo-desc">
            
            Jay&#39;s Blog
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/galleries" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-image"></i>
			
			相册
		</a>
          
        </li>
        
        
    </ul>
</div>


        </div>

        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/31.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">Pandas学习</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/%E7%AC%94%E8%AE%B0/">
                                <span class="chip bg-color">笔记</span>
                            </a>
                        
                            <a href="/tags/Python/">
                                <span class="chip bg-color">Python</span>
                            </a>
                        
                            <a href="/tags/Pandas/">
                                <span class="chip bg-color">Pandas</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/Python/" class="post-category">
                                Python
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2024-08-01
                </div>
                

                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    8.6k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    32 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.min.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="Pandas"><a href="#Pandas" class="headerlink" title="Pandas"></a>Pandas</h1><h2 id="序列与数据框的构造"><a href="#序列与数据框的构造" class="headerlink" title="序列与数据框的构造"></a>序列与数据框的构造</h2><ul>
<li>Pandas 模块的核心操作对象就是<strong>序列（<code>Series</code>）和数据框（<code>DataFrame</code>）</strong>。序列可以理解为数据集中的一个<strong>字段</strong>，数据框是指含有至少两个字段（或序列）的<strong>数据集</strong>。</li>
</ul>
<h3 id="构造序列"><a href="#构造序列" class="headerlink" title="构造序列"></a>构造序列</h3><ul>
<li>构造一个序列可以使用如下方式实现<ul>
<li>通过同质的<strong>列表或元组</strong>构建。</li>
<li>通过<strong>字典</strong>构建。</li>
<li>通过 Numpy 中的<strong>一维数组</strong>构建。</li>
<li>通过数据框 DataFrame 中的<strong>某一列</strong>构建。</li>
</ul>
</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#导入模块</span>
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token comment">#构造序列</span>
gdp1 <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2.8</span><span class="token punctuation">,</span><span class="token number">3.01</span><span class="token punctuation">,</span><span class="token number">8.99</span><span class="token punctuation">,</span><span class="token number">8.59</span><span class="token punctuation">,</span><span class="token number">5.18</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
gdp2 <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span> <span class="token punctuation">{</span><span class="token string">'北京'</span><span class="token punctuation">:</span><span class="token number">2.8</span><span class="token punctuation">,</span><span class="token string">'上海'</span><span class="token punctuation">:</span><span class="token number">3.01</span><span class="token punctuation">,</span><span class="token string">'广东'</span><span class="token punctuation">:</span><span class="token number">8.9</span><span class="token punctuation">,</span><span class="token string">'江苏'</span><span class="token punctuation">:</span><span class="token number">8.59</span><span class="token punctuation">,</span><span class="token string">'浙江'</span><span class="token punctuation">:</span><span class="token number">5.18</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
gdp3 <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">2.8</span><span class="token punctuation">,</span><span class="token number">3.01</span><span class="token punctuation">,</span><span class="token number">8.99</span><span class="token punctuation">,</span><span class="token number">8.59</span><span class="token punctuation">,</span><span class="token number">5.18</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span> <span class="token punctuation">(</span>gdp1<span class="token punctuation">)</span>
<span class="token keyword">print</span> <span class="token punctuation">(</span>gdp2<span class="token punctuation">)</span>
out<span class="token punctuation">:</span>
<span class="token number">0</span> <span class="token number">2.80</span>
<span class="token number">1</span> <span class="token number">3.01</span>
<span class="token number">2</span> <span class="token number">8.99</span>
<span class="token number">3</span> <span class="token number">8.59</span>
<span class="token number">4</span> <span class="token number">5.18</span>
dtype<span class="token punctuation">:</span> float64
上海 <span class="token number">3.01</span>
北京 <span class="token number">2.80</span>
广东 <span class="token number">8.99</span>
江苏 <span class="token number">8.59</span>
浙江 <span class="token number">5.18</span>
dtype<span class="token punctuation">:</span> float64<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>​ 不管是列表、元组还是一维数组，构造的序列结果会产生两列，第一列属于序列的行索引（可以理解为行号），自动从 0 开始，第二列才是序列的实际值。</p>
<p>​ 通过字典构造的序列仍然包含两列，所不同的是第一列不再是行号，而是具体的行名称（label），对应到字典中的键，第二列是序列的实际值，对应到字典中的值。</p>
<ul>
<li><p>序列与一维数组有极高的相似性，获取一维数组元素的所有索引方法都可以应用在序列上，而且数组的数学和统计函数也同样可以应用到序列对象上，不同的是，序列会有更多的其他处理方法。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#取出 gdp1中的第一、第四和第五个元素</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'行号风格的序列:\n'</span><span class="token punctuation">,</span>gdp1<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">#取出 gdp2中的第一、第四和第五个元素</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'行名称风格的序列:\n '</span> <span class="token punctuation">,</span> gdp2<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">#取出 gdp2中上海、江苏和浙江的GDP 值</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'行名称风格的序列:\n '</span> <span class="token punctuation">,</span> gdp2<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'上海'</span><span class="token punctuation">,</span><span class="token string">'江苏'</span><span class="token punctuation">,</span><span class="token string">'浙江'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">#数学函数--取对数</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'通过numpy函数: \n'</span><span class="token punctuation">,</span>np<span class="token punctuation">.</span>log<span class="token punctuation">(</span>gdp1<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#平均gdp</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'通过numpy函数:\n'</span> <span class="token punctuation">,</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>gdp1<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'通过序列的方法:\n'</span><span class="token punctuation">,</span>gdp1<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
行号风格的序列<span class="token punctuation">:</span>
 <span class="token number">0</span>    <span class="token number">2.80</span>
<span class="token number">3</span>    <span class="token number">8.59</span>
<span class="token number">4</span>    <span class="token number">5.18</span>
dtype<span class="token punctuation">:</span> float64
行名称风格的序列<span class="token punctuation">:</span>
  北京    <span class="token number">2.80</span>
江苏    <span class="token number">8.59</span>
浙江    <span class="token number">5.18</span>
dtype<span class="token punctuation">:</span> float64
行名称风格的序列<span class="token punctuation">:</span>
  上海    <span class="token number">3.01</span>
江苏    <span class="token number">8.59</span>
浙江    <span class="token number">5.18</span>
dtype<span class="token punctuation">:</span> float64
通过numpy函数<span class="token punctuation">:</span>
 <span class="token number">0</span>    <span class="token number">1.029619</span>
<span class="token number">1</span>    <span class="token number">1.101940</span>
<span class="token number">2</span>    <span class="token number">2.196113</span>
<span class="token number">3</span>    <span class="token number">2.150599</span>
<span class="token number">4</span>    <span class="token number">1.644805</span>
dtype<span class="token punctuation">:</span> float64
通过numpy函数<span class="token punctuation">:</span>
 <span class="token number">5.714</span>
通过序列的方法<span class="token punctuation">:</span>
<span class="token number">5.714</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>如果序列是行名称风格，既可以使用位置（行号）索引，又可以使用标签（行名称）索引；如果需要对序列进行数学函数的运算，一般首选 numpy 模块，因为 Pandas 模块在这方面比较缺乏；如果是对序列做统计运算，既可以使用 numpy 模块中的函数，也可以使用序列的“方法”,一般首选序列方法</p>
</li>
</ul>
<h3 id="构造数据框"><a href="#构造数据框" class="headerlink" title="构造数据框"></a>构造数据框</h3><ul>
<li>数据框实质上就是一个数据集，数据集的<strong>行代表每一条观测</strong>，数据集的<strong>列则代表各个变量</strong>。在一个数据框中可以存放不同数据类型的序列，如<strong>整数型、浮点型、字符型和日期时间型。</strong></li>
<li>构造一个数据库可以应用如下方式<ul>
<li>通过嵌套的<strong>列表或元组</strong>构造。</li>
<li>通过<strong>字典</strong>构造。</li>
<li>通过<strong>二维数组</strong>构造。</li>
<li>通过<strong>外部数据</strong>的读取构造。</li>
</ul>
</li>
<li>构造数据框</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#构造数据框</span>
df1 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">'张三'</span><span class="token punctuation">,</span><span class="token number">23</span><span class="token punctuation">,</span><span class="token string">'男'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'李四'</span><span class="token punctuation">,</span><span class="token number">27</span><span class="token punctuation">,</span><span class="token string">'女'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span> <span class="token string">'王二'</span><span class="token punctuation">,</span><span class="token number">26</span><span class="token punctuation">,</span><span class="token string">'女'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
df2 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">'姓名'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token string">'张三'</span><span class="token punctuation">,</span><span class="token string">'李四'</span><span class="token punctuation">,</span><span class="token string">'王二'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'年龄'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">23</span><span class="token punctuation">,</span><span class="token number">27</span><span class="token punctuation">,</span><span class="token number">26</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'性别'</span><span class="token punctuation">:</span><span class="token punctuation">[</span> <span class="token string">'男'</span><span class="token punctuation">,</span><span class="token string">'女'</span><span class="token punctuation">,</span> <span class="token string">'女'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
df3 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">'张三'</span><span class="token punctuation">,</span><span class="token number">23</span><span class="token punctuation">,</span><span class="token string">'男'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span> <span class="token string">'李四'</span><span class="token punctuation">,</span><span class="token number">27</span><span class="token punctuation">,</span><span class="token string">'女'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'王二'</span> <span class="token punctuation">,</span><span class="token number">26</span><span class="token punctuation">,</span><span class="token string">'女'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'嵌套列表构造数据框:\n'</span><span class="token punctuation">,</span>df1<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'字典构造数据框:\n'</span><span class="token punctuation">,</span>df2<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'二维数组构造数据框:\n'</span><span class="token punctuation">,</span>df3<span class="token punctuation">)</span>
嵌套列表构造数据框<span class="token punctuation">:</span>
     <span class="token number">0</span>   <span class="token number">1</span>  <span class="token number">2</span>
<span class="token number">0</span>  张三  <span class="token number">23</span>  男
<span class="token number">1</span>  李四  <span class="token number">27</span>  女
<span class="token number">2</span>  王二  <span class="token number">26</span>  女
字典构造数据框<span class="token punctuation">:</span>
    姓名  年龄 性别
<span class="token number">0</span>  张三  <span class="token number">23</span>  男
<span class="token number">1</span>  李四  <span class="token number">27</span>  女
<span class="token number">2</span>  王二  <span class="token number">26</span>  女
二维数组构造数据框<span class="token punctuation">:</span>
     <span class="token number">0</span>   <span class="token number">1</span>  <span class="token number">2</span>
<span class="token number">0</span>  张三  <span class="token number">23</span>  男
<span class="token number">1</span>  李四  <span class="token number">27</span>  女
<span class="token number">2</span>  王二  <span class="token number">26</span>  女<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>构造数据框需要使用到 Pandas 模块中的<code>DataFrame</code>函数，如果通过嵌套列表或元组构造数据框，则需要将数据框中的每一行观测作为嵌套列表或元组的元素；如果通过二维数组构造数据框，则需要将数据框的每一行写入到数组的行中；如果通过字典构造数据框，则字典的键构成数据框的变量名，对应的值构成数据框的观测。</p>
<h2 id="外部数据的读取"><a href="#外部数据的读取" class="headerlink" title="外部数据的读取"></a>外部数据的读取</h2><h3 id="文本文件的读取"><a href="#文本文件的读取" class="headerlink" title="文本文件的读取"></a>文本文件的读取</h3><ul>
<li><p>使用 Python 读取<code>txt</code>或<code>csv</code>格式中的数据，可以使用 Pandas 模块中的<code>read_table</code>函数或<code>read_csv</code>函数。这两种函数均可以读取文本文件的数据且功能相似。</p>
</li>
<li><p><strong><code>pd.read_table(filepath_or_buffer, sep='\t', header='infer', names=None, index_col=None, usecols=None, dtype = None, converters=None, skiprows=None, skipfooter=None, nrows=None, na_values=None, skip_blank_lines=True, parse_dates=False, thousands=None, comment=None, encoding=None</code></strong></p>
<ul>
<li><strong>filepath_or_buffer</strong>：指定 txt 文件或 csv 文件所在的具体路径。</li>
<li><strong>sep</strong>：指定原数据集中各字段之间的分隔符，默认为 Tab 制表符。</li>
<li><strong>header</strong>：是否需要将原数据集中的第一行作为表头，默认将第一行用作字段名称。</li>
<li><strong>names</strong>：如果原数据集中没有字段，可以通过该参数在数据读取时给数据框添加具体的表头。</li>
<li><strong>index_col</strong>：指定原数据集中的某些列作为数据框的行索引（标签）。</li>
<li><strong>usecols</strong>：指定需要读取原数据集中的哪些变量名。</li>
<li><strong>dtype</strong>：读取数据时，可以为原数据集的每个字段设置不同的数据类型。</li>
<li><strong>converters</strong>：通过字典格式，为数据集中的某些字段设置转换函数。</li>
<li><strong>skiprows</strong>：数据读取时，指定需要跳过原数据集开头的行数。</li>
<li><strong>skipfooter</strong>：数据读取时，指定需要跳过原数据集末尾的行数。</li>
<li><strong>nrows</strong>：指定读取数据的行数。</li>
<li><strong>na_values</strong>：指定原数据集中哪些特征的值作为缺失值。</li>
<li><strong>skip_blank_lines</strong>：读取数据时是否需要跳过原数据集中的空白行，默认为 True。</li>
<li><strong>parse_dates</strong>：如果参数值为 True，则尝试解析数据框的行索引；如果参数为列表，则尝试解析对应的日期列；如果参数为嵌套列表，则将某些列合并为日期列；如果参数为字典，则解析对应的列（字典中的值），并生成新的字段名（字典中的键）。</li>
<li><strong>thousands</strong>：指定原始数据集中的千分位符。</li>
<li><strong>comment</strong>：指定注释符，在读取数据时，如果碰到行首指定的注释符，则跳过改行。</li>
<li><strong>encoding</strong>：如果文件中含有中文，有时需要指定字符编码。</li>
</ul>
</li>
<li><p><code>read_table</code>读取示例<br><img src="https://cdn.jsdelivr.net/gh/Eliauk-L/blog-img@img/img/202408012222955.png" alt="待读取txt文件"></p>
<ul>
<li><p>问题分析</p>
<ul>
<li>数据集并不是从第一行开始，前面几行实际上是数据集的来源说明，读取数据时需要注意什么问题。</li>
<li>数据集的末尾 3 行仍然不是需要读入的数据，如何避免后 3 行数据的读入。</li>
<li>中间部分的数据，第四行前加了#号，表示不需要读取该行，该如何处理。</li>
<li>数据集中的收入一列，千分位符是&amp;，如何将该字段读入为正常的数值型数据。</li>
<li>如果需要将 year、month 和 day 三个字段解析为新的 birthday 字段，该如何做到。</li>
<li>数据集中含有中文，一般在读取含中文的文本文件时都会出现编码错误，该如何解决</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#读取文本文件中的数据</span>
user_income <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_table<span class="token punctuation">(</span>
    <span class="token string">r'C:\Users\Administrator\Desktopldata_test01.txt'</span><span class="token punctuation">,</span>
    sep <span class="token operator">=</span> <span class="token string">','</span><span class="token punctuation">,</span>
    parse_dates<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'birthday'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    skiprows<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>
    skipfooter<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span>
    comment<span class="token operator">=</span><span class="token string">'#'</span><span class="token punctuation">,</span>
    encoding<span class="token operator">=</span><span class="token string">'utf8'</span><span class="token punctuation">,</span>
    thousands<span class="token operator">=</span><span class="token string">'&amp;'</span><span class="token punctuation">)</span>
user_income<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/Eliauk-L/blog-img@img/img/202408012222512.png" alt="txt数据读取结果"></p>
</li>
</ul>
</li>
</ul>
<h3 id="电子表格的读取"><a href="#电子表格的读取" class="headerlink" title="电子表格的读取"></a>电子表格的读取</h3><ul>
<li><p><strong><code>pd.read_excel(io, sheetname=0, header=0，skiprows=None, skip_footer=0,
index_col=None, names=None, parse_cols=None, parse_dates=False, na_values=None, thousands=None, convert_float=True)</code></strong></p>
<ul>
<li><strong>io</strong>：指定电子表格的具体路径。</li>
<li><strong>sheetname</strong>：指定需要读取电子表格中的第几个 Sheet，既可以传递整数也可以传递具体的 Sheet 名称。</li>
<li><strong>header</strong>：是否需要将数据集的第一行用作表头，默认为是需要的。</li>
<li><strong>skiprows</strong>：读取数据时，指定跳过的开始行数。</li>
<li><strong>skip_footer</strong>：读取数据时，指定跳过的末尾行数。</li>
<li><strong>index_col</strong>：指定哪些列用作数据框的行索引（标签）。</li>
<li><strong>names</strong>：如果原数据集中没有字段，可以通过该参数在数据读取时给数据框添加具体的表头。</li>
<li><strong>parse_cols</strong>：指定需要解析的字段。</li>
<li><strong>parse_dates</strong>：如果参数值为 True，则尝试解析数据框的行索引；如果参数为列表，则尝试解析对应的日期列；如果参数为嵌套列表，则将某些列合并为日期列；如果参数为字典，则解析对应的列（字典中的值），并生成新的字段名（字典中的键）。</li>
<li><strong>na_values</strong>：指定原始数据中哪些特殊值代表了缺失值。</li>
<li><strong>thousands</strong>：指定原始数据集中的千分位符。</li>
<li><strong>convert_float</strong>：默认将所有的数值型字段转换为浮点型字段。</li>
<li><strong>converters</strong>：通过字典的形式，指定某些列需要转换的形式。</li>
</ul>
</li>
<li><p><code>read_excel</code>使用实例<br><img src="https://cdn.jsdelivr.net/gh/Eliauk-L/blog-img@img/img/202408012222172.png" alt="待读取excel数据"></p>
<p>在读取数据时需要注意两点：一点是该表没有表头，如何读数据的同时就设置好具体的表头；另一点是数据集的第一列实际上是字符型的字段，如何避免数据读入时自动变成数值型字段。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">child_cloth <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>
    io <span class="token operator">=</span> <span class="token string">r'C:\Users\Administrator\Desktopldata_test02.xlsx'</span><span class="token punctuation">,</span>
    header <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
    converters <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token builtin">str</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    names <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token string">'Prod_Id'</span> <span class="token punctuation">,</span> <span class="token string">'Prod_Name '</span> <span class="token punctuation">,</span> <span class="token string">'Prod_Color'</span><span class="token punctuation">,</span> <span class="token string">'Prod_Price'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
child_cloth<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/Eliauk-L/blog-img@img/img/202408012222607.png" alt="excel数据读取结果"></p>
</li>
</ul>
<h3 id="数据库数据的读取"><a href="#数据库数据的读取" class="headerlink" title="数据库数据的读取"></a>数据库数据的读取</h3><ul>
<li><p>安装 pymysql：<code>pip install pymysql</code></p>
</li>
<li><p>mysql 链接：<strong><code>pymysql.connect(host=None, user=None, password='', database=None, port=0, charset='')</code></strong></p>
<ul>
<li><strong>host</strong>：指定需要访问的 MySQL 服务器。</li>
<li><strong>user</strong>：指定访问 MySQL 数据库的用户名。</li>
<li><strong>password</strong>：指定访问 MySQL 数据库的密码。</li>
<li><strong>database</strong>：指定访问 MySQL 数据库的具体库名。</li>
<li><strong>port</strong>：指定访问 MySQL 数据库的端口号。</li>
<li><strong>charset</strong>：指定读取 MySQL 数据库的字符集，如果数据库表中含有中文，一般可以尝试将该参数设置为“utf8”或“gbk”。</li>
</ul>
</li>
<li><p>使用 pandas 读取数据库数据</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#读入 MySQL 数据库数据#导入第三方模块</span>
<span class="token keyword">import</span> pymysql
<span class="token comment">#连接MySQL数据库</span>
conn <span class="token operator">=</span> pymysql<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'localhost'</span><span class="token punctuation">,</span> user<span class="token operator">=</span><span class="token string">'root '</span><span class="token punctuation">,</span>password<span class="token operator">=</span><span class="token string">'test'</span><span class="token punctuation">,</span> database<span class="token operator">=</span><span class="token string">'test'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">3306</span><span class="token punctuation">,</span>charset<span class="token operator">=</span><span class="token string">'utf8'</span><span class="token punctuation">)</span>
<span class="token comment">#读取数据</span>
user <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_sql<span class="token punctuation">(</span><span class="token string">'select * from topy'</span><span class="token punctuation">,</span>conn<span class="token punctuation">)</span>
<span class="token comment">#关闭连接</span>
conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#数据输出</span>
User<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/Eliauk-L/blog-img@img/img/202408012222689.png" alt="MySQL数据的读取结果"></p>
</li>
</ul>
<h2 id="数据类型转换及描述统计"><a href="#数据类型转换及描述统计" class="headerlink" title="数据类型转换及描述统计"></a>数据类型转换及描述统计</h2><ul>
<li><p>本节内容主要介绍如何了解数据，例如读入数据的规模如何、各个变量都属于什么数据类型、一些重要的统计指标对应的值是多少、离散变量各唯一值的频次该如何统计等。</p>
</li>
<li><p>下面以某平台二手车信息为例</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 数据读取</span>
sec_cars <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_table<span class="token punctuation">(</span><span class="token string">r'C:\Users\Administrator\Desktop\sec_cars.csv'</span><span class="token punctuation">,</span> sep <span class="token operator">=</span> <span class="token string">','</span><span class="token punctuation">)</span>
<span class="token comment"># 预览数据的前五行</span>
sec_cars<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 预览数据的后五行</span>
<span class="token comment"># sec_cars.tail()</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/Eliauk-L/blog-img@img/img/202408012223309.png" alt="二手车数据的前5行预览"></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#查看数据的行列数</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'数据集的行列数:\n'</span><span class="token punctuation">,</span>sec_cars<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
<span class="token comment">#查看数据集每个变量的数据类型</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'各变量的数据类型:\n'</span><span class="token punctuation">,</span>sec_cars<span class="token punctuation">.</span>dtypes<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/Eliauk-L/blog-img@img/img/202408012223894.png" alt="数据的行列数和变量数据类型"></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#修改二手车上牌时间的数据类型</span>
sec_cars<span class="token punctuation">.</span>Boarding_time <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_datetime<span class="token punctuation">(</span>sec_cars<span class="token punctuation">.</span>Boarding_time<span class="token punctuation">,</span><span class="token builtin">format</span> <span class="token operator">=</span> <span class="token string">'%Y年%m月'</span><span class="token punctuation">)</span>
<span class="token comment">#修改二手车新车价格的数据类型</span>
sec_cars<span class="token punctuation">.</span>New price <span class="token operator">=</span> sec_cars<span class="token punctuation">.</span>New_price<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'float'</span><span class="token punctuation">)</span>
<span class="token comment">#重新查看各变量数据类型</span>
sec_cars<span class="token punctuation">.</span>dtypes<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/Eliauk-L/blog-img@img/img/202408012223851.png" alt="修改时间和价格数据类型"></p>
<p>Pandas 模块中的<code>to_datetime</code>函数可以通过 format 参数灵活地将各种格式的字符型日期转换成真正的日期数据；由于二手车新车价格含有“万”字，因此不能直接转换数据类型，为达到目的，需要三步走，首先通过<em>str</em>方法将该字段转换成字符串，然后通过<em>切片</em>手段，将“万”字剔除，最后运用<em>astype</em>方法，实现数据类型的转换。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 数据的描述性统计</span>
sec_cars<span class="token punctuation">.</span>describe<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/Eliauk-L/blog-img@img/img/202408012223335.png" alt=" 数值型数据的统计描述"></p>
<p>通过 describe 方法，直接运算了数据框中所有数值型变量的统计值，包括<strong>非缺失个数、平均值、标准差、最小值、下四分位数、中位数、上四分位数和最大值</strong>。</p>
<p>以二手车的售价 Sec_price 为例，平均价格为 25.7 万（很明显会受到极端值的影响）、中位数价格为 10.2 万（即一半的二手车价格不超过 10.2 万）、最高售价为 808 万、最低售为 0.65 万、绝大多数二手车价格不超过 23.8 万（上四分位数 75%对应的值）。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#挑出所有数值型变量</span>
<span class="token comment"># 返回数据集的所有变量名，通过布尔索引和切片方法获得所有的数值型变量</span>
num_variables <span class="token operator">=</span> sec_cars<span class="token punctuation">.</span>columns<span class="token punctuation">[</span>sec_cars<span class="token punctuation">.</span>dtypes <span class="token operator">!=</span><span class="token string">'object'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
<span class="token comment">#自定义函数，计算偏度和峰度</span>
<span class="token keyword">def</span> <span class="token function">skew_kurt</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
	 skewness <span class="token operator">=</span> x<span class="token punctuation">.</span>skew<span class="token punctuation">(</span><span class="token punctuation">)</span>
    kurtsis <span class="token operator">=</span> x<span class="token punctuation">.</span>kurt<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">#返回偏度值和峰度值</span>
	 <span class="token keyword">return</span> pd<span class="token punctuation">.</span>Series <span class="token punctuation">(</span><span class="token punctuation">[</span>skewness<span class="token punctuation">,</span> kurtsis<span class="token punctuation">]</span><span class="token punctuation">,</span> index <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token string">'Skew'</span><span class="token punctuation">,</span> <span class="token string">'Kurt'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">#运用 apply方法</span>
<span class="token comment"># 对指定轴（axis=0，即垂直方向的各列）进行统计运算（运算函数即自定义函数）</span>
sec_cars<span class="token punctuation">[</span>num_variables<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>func <span class="token operator">=</span> skew_kurt<span class="token punctuation">,</span>axis <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/Eliauk-L/blog-img@img/img/202408012223675.png" alt="数值型数据的偏度和峰度"></p>
<p>每个数值型变量的偏度和峰度，这三个变量都属于右偏（因为偏度值均大于 0），而且三个变量也是尖峰的（因为峰度值也都大于 0）。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 离散型变量的统计描述</span>
sec_cars<span class="token punctuation">.</span>describe<span class="token punctuation">(</span>include <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'object'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/Eliauk-L/blog-img@img/img/202408012223817.png" alt="离散型数据的统计描述"></p>
<p>包含离散变量的四个统计值，分别是<strong>非缺失观测数、唯一水平数、频次最高的离散值和具体的频次</strong>。以二手车品牌为例，一共有 10 984 辆二手车，包含 104 种品牌，其中别克品牌最多，高达 1 346 辆。需要注意的是，如果对离散型变量作统计分析，需要将“object”以列表的形式传递给 include 参数。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 离散变量频次统计 以二手车品的标准排量Discharge为例</span>
Freq <span class="token operator">=</span> sec_cars<span class="token punctuation">.</span>Discharge<span class="token punctuation">.</span>value_counts<span class="token punctuation">(</span><span class="token punctuation">)</span>
Freq_ratio <span class="token operator">=</span> Freq<span class="token operator">/</span>sec_cars<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
Freq_df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'Freq'</span><span class="token punctuation">:</span>Freq<span class="token punctuation">,</span><span class="token string">'Freq_ratio'</span><span class="token punctuation">:</span>Freq_ratio<span class="token punctuation">}</span><span class="token punctuation">)</span>
Freq_df<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/Eliauk-L/blog-img@img/img/202408012223996.png" alt="变量值的频次统计"></p>
<p>构成的数据框包含两列，分别是二手车各种标准排量对应的频次和频率，数据框的行索引（标签）就是二手车不同的标准排量。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 将行索引重设为变量</span>
<span class="token comment"># 把行标签设置为数据框中的列</span>
Freq_df<span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span>inplace <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
Freq_df<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/Eliauk-L/blog-img@img/img/202408012223977.png" alt="将行索引转为字段"></p>
<p><code>reset_index</code>方法可以非常方便地将行标签转换为数据框的变量。在如上代码中，将 reset_index 方法中的<code>inplace</code>参数设置为<code>True</code>，表示直接对原始数据集进行操作，影响到原数据集的变化，否则返回的只是变化预览，并不会改变原数据集。</p>
</li>
</ul>
<h2 id="字符与日期数据的处理"><a href="#字符与日期数据的处理" class="headerlink" title="字符与日期数据的处理"></a>字符与日期数据的处理</h2><ul>
<li><p>待处理的数据表<br><img src="https://cdn.jsdelivr.net/gh/Eliauk-L/blog-img@img/img/202408012223260.png" alt="待处理的数据表"></p>
<ul>
<li>如何更改出生日期 birthday 和手机号 tel 两个字段的数据类型。</li>
<li>如何根据出生日期 birthday 和开始工作日期 start_work 两个字段新增年龄和工龄两个字段。</li>
<li>如何将手机号 tel 的中间四位隐藏起来。</li>
<li>如何根据邮箱信息新增邮箱域名字段。</li>
<li>如何基于 other 字段取出每个人员的专业信息。</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#数据读入</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span><span class="token string">r'C:\Users\Administrator\Desktopldata_test03.xlsx'</span><span class="token punctuation">)</span>
<span class="token comment">#各变量数据类型</span>
df<span class="token punctuation">.</span>dtypes
<span class="token comment">#将birthday变量转换为日期型</span>
df<span class="token punctuation">.</span>birthday <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_datetime<span class="token punctuation">(</span>df<span class="token punctuation">.</span>birthday<span class="token punctuation">,</span><span class="token builtin">format</span> <span class="token operator">=</span> <span class="token string">'%Y/%m/%d '</span><span class="token punctuation">)</span>
<span class="token comment">#将手机号转换为字符串</span>
df<span class="token punctuation">.</span>tel <span class="token operator">=</span> df<span class="token punctuation">.</span>tel<span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'str'</span><span class="token punctuation">)</span>
<span class="token comment">#新增年龄和工龄两列</span>
df<span class="token punctuation">[</span><span class="token string">'age'</span><span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>today<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>year <span class="token operator">-</span> df<span class="token punctuation">.</span>birthday<span class="token punctuation">.</span>dt<span class="token punctuation">.</span>year
df<span class="token punctuation">[</span><span class="token string">'workage'</span><span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>today<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>year <span class="token operator">-</span> df<span class="token punctuation">.</span>start_work<span class="token punctuation">.</span>dt<span class="token punctuation">.</span>year
<span class="token comment">#将手机号中间四位隐藏起来</span>
df<span class="token punctuation">.</span>tel <span class="token operator">=</span> df<span class="token punctuation">.</span>tel<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>func <span class="token operator">=</span> <span class="token keyword">lambda</span> x <span class="token punctuation">:</span> x<span class="token punctuation">.</span>replace<span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">7</span><span class="token punctuation">]</span>，<span class="token string">'**** '</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#取出邮箱的域名</span>
df<span class="token punctuation">[</span><span class="token string">'email_domain'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">.</span>email<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>func <span class="token operator">=</span> <span class="token keyword">lambda</span> x <span class="token punctuation">:</span> x<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'@'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">#取出人员的专业信息</span>
df<span class="token punctuation">[</span><span class="token string">'profession'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">.</span>other<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">'专业:(.*?)，'</span><span class="token punctuation">)</span>
<span class="token comment">#去除birthday、start_work和 other变量，axis=1删除列数据，默认删除行数据</span>
df<span class="token punctuation">.</span>drop <span class="token punctuation">(</span><span class="token punctuation">[</span> <span class="token string">'birthday'</span> <span class="token punctuation">,</span> <span class="token string">'start_work'</span> <span class="token punctuation">,</span> <span class="token string">' other'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> axis <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> inplace <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/Eliauk-L/blog-img@img/img/202408012223676.png" alt="代码结果"></p>
</li>
<li><p>常用的日期时间处理“方法”</p>
<p><img src="https://cdn.jsdelivr.net/gh/Eliauk-L/blog-img@img/img/202408012223679.png" alt="常用的日期时间处理“方法”"></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#常用日期处理方法</span>
dates <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_datetime<span class="token punctuation">(</span>
    pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'1989-8-18 13:14:55'</span><span class="token punctuation">,</span> <span class="token string">'1995-2-16'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token builtin">format</span> <span class="token operator">=</span> <span class="token string">'%Y-%m-%d %H:%M:%S'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'返回日期值:\n '</span><span class="token punctuation">,</span> dates<span class="token punctuation">.</span>dt<span class="token punctuation">.</span>date<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'返回季度:n'</span> <span class="token punctuation">,</span> dates<span class="token punctuation">.</span>dt<span class="token punctuation">.</span>quarter<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'返回几点钟: \n '</span><span class="token punctuation">,</span> dates<span class="token punctuation">.</span>dt<span class="token punctuation">.</span>hour<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'返回年中的天:\n '</span><span class="token punctuation">,</span> dates<span class="token punctuation">.</span>dt<span class="token punctuation">.</span>dayofyear<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'返回年中的周:n '</span> <span class="token punctuation">,</span> dates<span class="token punctuation">.</span>dt<span class="token punctuation">.</span>weekofyear<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'返回星期几的名称: n '</span> <span class="token punctuation">,</span> dates<span class="token punctuation">.</span>dt<span class="token punctuation">.</span>weekday_name<span class="token punctuation">)</span>
<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">'返回月份的天数: \n'</span> <span class="token punctuation">,</span> dates<span class="token punctuation">.</span>dt<span class="token punctuation">.</span>days_in_month<span class="token punctuation">)</span>
out<span class="token punctuation">:</span>
返回日期值<span class="token punctuation">:</span>
<span class="token number">0</span>	<span class="token number">1989</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">18</span>
<span class="token number">1</span>	<span class="token number">1995</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">16</span>
dtype<span class="token punctuation">:</span> <span class="token builtin">object</span>
返回季度<span class="token punctuation">;</span>
<span class="token number">0</span>	<span class="token number">3</span>
<span class="token number">1</span>	<span class="token number">1</span>
dtype<span class="token punctuation">:</span> int64
返回几点钟<span class="token punctuation">:</span>
<span class="token number">0</span>	<span class="token number">13</span>
<span class="token number">1</span>	<span class="token number">0</span>
dtype<span class="token punctuation">:</span> int64
返回年中的天<span class="token punctuation">:</span>
<span class="token number">0</span> 	<span class="token number">230</span>
<span class="token number">1</span>  <span class="token number">47</span>
dtype<span class="token punctuation">:</span> int64
返回年中的周<span class="token punctuation">:</span>
<span class="token number">0</span>	<span class="token number">33</span>
<span class="token number">1</span>	<span class="token number">7</span>
dtype<span class="token punctuation">:</span> int64
返回星期几的名称<span class="token punctuation">:</span>
<span class="token number">0</span>	Friday
<span class="token number">1</span>  Thursday
dtype<span class="token punctuation">:</span> <span class="token builtin">object</span>
返回月份的天数<span class="token punctuation">:</span>
<span class="token number">0</span>	<span class="token number">31</span>
<span class="token number">1</span> 	<span class="token number">28</span>
dtype<span class="token punctuation">:</span> int64<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
</ul>
<h2 id="常用的数据清洗方法"><a href="#常用的数据清洗方法" class="headerlink" title="常用的数据清洗方法"></a>常用的数据清洗方法</h2><ul>
<li>在数据处理过程中，一般都需要进行数据的清洗工作，如<strong>数据集是否存在重复、是否存在缺失、数据是否具有完整性和一致性、数据中是否存在异常值</strong>等。</li>
</ul>
<h3 id="重复观测处理"><a href="#重复观测处理" class="headerlink" title="重复观测处理"></a>重复观测处理</h3><ul>
<li><p>重复观测，顾名思义是指观测行存在重复的现象，重复观测的存在会影响数据分析和挖掘结果的准确性，所以在数据分析和建模之前需要进行观测的重复性检验，如果存在重复观测，还需要进行重复项的删除。</p>
</li>
<li><p>待清洗数据<br><img src="https://cdn.jsdelivr.net/gh/Eliauk-L/blog-img@img/img/202408012223641.png" alt="待清洗数据"></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 数据读入</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span><span class="token string">r'C:\Users\Administrator\Desktop\data_test04.xlsx'</span><span class="token punctuation">)</span>
<span class="token comment"># 重复观测的检测</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'数据集中是否存在重复观测：\n'</span><span class="token punctuation">,</span><span class="token builtin">any</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>duplicated<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
out<span class="token punctuation">:</span>
数据集中是否存在重复观测：
<span class="token boolean">True</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>检测数据集的记录是否存在重复，可以使用 duplicated 方法进行验证，但是该方法返回的是数据集每一行的检验结果，即 10 行数据会返回 10 个 bool 值。很显然，这样也不能直接得知数据集的观测是否重复，为了能够得到最直接的结果，可以使用 any 函数。该函数表示的是在多个条件判断中，只要有一个条件为 True，则 any 函数的结果就为 True。正如结果所示，any 函数的运用返回 True 值，说明该数据集是存在重复观测的。</p>
</li>
<li><p>删除数据集中的重复观测</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 删除重复项,inplace=True表示就在原数据表上操作</span>
df<span class="token punctuation">.</span>drop_duplicates<span class="token punctuation">(</span>inplace <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
df<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/Eliauk-L/blog-img@img/img/202408012223421.png" alt="重复观测的删除结果"></p>
</li>
</ul>
<h3 id="缺失值处理"><a href="#缺失值处理" class="headerlink" title="缺失值处理"></a>缺失值处理</h3><ul>
<li><p>缺失值是指数据集中的某些观测存在遗漏的指标值，缺失值的存在同样会影响到数据分析和挖掘的结果。导致观测的缺失可能有两方面原因，一方面是人为原因（如记录过程中的遗漏、个人隐私而不愿透露等），另一方面是机器或设备的故障所导致（如断电或设备老化等原因）。</p>
</li>
<li><p>一般而言，当遇到缺失值（Python 中用 NaN 表示）时，可以采用三种方法处置，分别是<strong>删除法、替换法和插补法</strong>。删除法是指当缺失的观测比例非常低时（如 5%以内），直接<strong>删除存在缺失的观测</strong>，或者当某些变量的缺失比例非常高时（如 85%以上），直接<strong>删除这些缺失的变量</strong>；替换法是指用某种常数直接替换那些缺失值，例如，对连续变量而言，可以使用<strong>均值或中位数替换</strong>，对于离散变量，可以使用<strong>众数替换</strong>；插补法是指根据其他非缺失的变量或观测来预测缺失值，常见的插补法有<strong>回归插补法、K 近邻插补法、拉格朗日插补法</strong>等。</p>
</li>
<li><p>待处理的缺失值数据</p>
<p><img src="https://cdn.jsdelivr.net/gh/Eliauk-L/blog-img@img/img/202408012223982.png" alt="待处理的缺失值数据"></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 数据读入</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span><span class="token string">r'C:\Users\Administrator\Desktop\data_test05.xlsx'</span><span class="token punctuation">)</span>
<span class="token comment"># 缺失观测的检测</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'数据集中是否存在缺失值：\n'</span><span class="token punctuation">,</span><span class="token builtin">any</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>isnull<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
out<span class="token punctuation">:</span>
数据集中是否存在缺失值：
<span class="token boolean">True</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>删除法</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 删除法之记录删除</span>
df<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 删除法之变量删除</span>
df<span class="token punctuation">.</span>drop<span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">,</span> axis <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/Eliauk-L/blog-img@img/img/202408012223123.png" alt="观测删除与变量删除"></p>
</li>
<li><p>替换法</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 替换法之前向替换</span>
df<span class="token punctuation">.</span>fillna<span class="token punctuation">(</span>method <span class="token operator">=</span> <span class="token string">'ffill'</span><span class="token punctuation">)</span>
<span class="token comment"># 替换法之后向替换</span>
df<span class="token punctuation">.</span>fillna<span class="token punctuation">(</span>method <span class="token operator">=</span> <span class="token string">'bfill'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/Eliauk-L/blog-img@img/img/202408012223304.png" alt="缺失观测的前向填充与后向填充"></p>
<p>缺失值的替换需要借助于 fillna 方法，该方法中的 method 参数可以接受’ffill’和’bfill’两种值，分别代表前向填充和后向填充。前向填充是指用缺失值的前一个值替换（如左表所示），而后向填充则表示用缺失值的后一个值替换（如右表所示）。右表中的最后一个记录仍包含缺失值，是因为后向填充法找不到该缺失值的后一个值用于替换。缺失值的前向填充或后向填充一般适用于<strong>时间序列型</strong>的数据集，因为这样的数据前后具有连贯性，而一般的独立性样本并不适用该方法。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#替换法之常数替换</span>
df<span class="token punctuation">.</span>fillna<span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token comment">#替换法之统计值替换</span>
df<span class="token punctuation">.</span>fillna <span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">' gender'</span> <span class="token punctuation">:</span>df<span class="token punctuation">.</span>gender<span class="token punctuation">.</span>mode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'age'</span> <span class="token punctuation">:</span>df<span class="token punctuation">.</span>age<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token string">'income'</span> <span class="token punctuation">:</span> df <span class="token punctuation">.</span>income<span class="token punctuation">.</span>median<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/Eliauk-L/blog-img@img/img/202408012223051.png" alt="缺失观测的值填充"></p>
</li>
</ul>
<h3 id="异常值处理"><a href="#异常值处理" class="headerlink" title="异常值处理"></a>异常值处理</h3><ul>
<li><p>异常值是指那些远离正常值的观测，即“不合群”观测。导致异常值的出现一般是人为的记录错误或者是设备的故障等，异常值的出现会对模型的创建和预测产生严重的后果。当然异常值也不一定都是坏事，有些情况下，通过寻找异常值就能够给业务带来良好的发展，如销毁“钓鱼”网站、关闭“薅羊毛”用户的权限等</p>
</li>
<li><p>对于异常值的检测，一般采用两种方法，一种是$n$个<strong>标准差法</strong>，另一种是<strong>箱线图判别法</strong>。标准差法的判断公式是$outlinear &gt; |\bar x\pm n\sigma|$ ，其中$\bar x$为样本均值，$σ$为样本标准差，当$n=2$时，满足条件的观测就是异常值，当$n=3$时，满足条件的观测就是极端异常值；箱线图的判断公式是$outlinear&gt;Q3+nIQR$或者$outlinear&lt;Q1-nIQR$，其中$Q1$为下四分位数（25%），$Q3$为上四位数（75%），$IQR$为四分位差（上四分位数与下四分位数的差），当$n=1.5s$时，满足条件的观测为异常值，当$n=3$时，满足条件的观测即为极端异常值。<br><img src="https://cdn.jsdelivr.net/gh/Eliauk-L/blog-img@img/img/202408012224028.png" alt="异常值判断的两种方法"></p>
<p>这两种方法的选择标准如下，如果数据近似服从<strong>正态分布</strong>时，优先选择<strong>n 个标准差法</strong>，因为数据的分布相对比较对称；否则优先选择箱线图法，因为分位数并不会受到极端值的影响。当数据存在异常时，一般可以使用<strong>删除法</strong>将异常值删除（前提是异常观测的比例不能太大）、<strong>替换法</strong>（可以考虑使用低于判别上限的最大值或高于判别下限的最小值替换、使用均值或中位数替换等）。</p>
</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#数据读入</span>
sunspots <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_table <span class="token punctuation">(</span><span class="token string">r'c:\Users\Administrator\DesktopIsunspots.csv'</span><span class="token punctuation">,</span>sep <span class="token operator">=</span> <span class="token string">', '</span><span class="token punctuation">)</span>
<span class="token comment">#异常值检测之标准差法</span>
xbar <span class="token operator">=</span>sunspots<span class="token punctuation">.</span>counts<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>
xstd <span class="token operator">=</span>sunspots<span class="token punctuation">.</span>counts<span class="token punctuation">.</span>std<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span> <span class="token string">'标准差法异常值上限检测: \n '</span> <span class="token punctuation">,</span><span class="token builtin">any</span> <span class="token punctuation">(</span>sunspots<span class="token punctuation">.</span>counts <span class="token operator">&gt;</span> xbar <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">*</span> xstd<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'标准差法异常值下限检测: \n '</span> <span class="token punctuation">,</span><span class="token builtin">any</span><span class="token punctuation">(</span>sunspots<span class="token punctuation">.</span>counts <span class="token operator">&lt;</span> xbar <span class="token operator">-</span> <span class="token number">2</span> <span class="token operator">*</span> xstd<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#异常值检测之箱线图法</span>
Ql <span class="token operator">=</span>sunspots<span class="token punctuation">.</span>counts<span class="token punctuation">.</span>quantile<span class="token punctuation">(</span>q <span class="token operator">=</span> <span class="token number">0.25</span><span class="token punctuation">)</span>
Q3 <span class="token operator">=</span>sunspots<span class="token punctuation">.</span>counts<span class="token punctuation">.</span>quantile<span class="token punctuation">(</span>q <span class="token operator">=</span> <span class="token number">0.75</span><span class="token punctuation">)</span>
IQR<span class="token operator">=</span> Q3 <span class="token operator">-</span> Q1
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'箱线图法异常值上限检测: \n '</span><span class="token punctuation">,</span><span class="token builtin">any</span> <span class="token punctuation">(</span>sunspots<span class="token punctuation">.</span>counts <span class="token operator">&gt;</span> Q3 <span class="token operator">+</span> <span class="token number">1.5</span> <span class="token operator">*</span> IQR<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span> <span class="token string">'箱线图法异常值下限检测: \n '</span><span class="token punctuation">,</span><span class="token builtin">any</span><span class="token punctuation">(</span>sunspots<span class="token punctuation">.</span>counts <span class="token operator">&lt;</span> Q1 <span class="token operator">-</span> <span class="token number">1.5</span> <span class="token operator">*</span> IQR<span class="token punctuation">)</span><span class="token punctuation">)</span>
out<span class="token punctuation">:</span>
标准差法异常值上限检测<span class="token punctuation">:</span><span class="token boolean">True</span>
标准差法异常值下限检测<span class="token punctuation">:</span><span class="token boolean">False</span>
箱线图法异常值上限检测<span class="token punctuation">:</span><span class="token boolean">True</span>
箱线图法异常值下限检测<span class="token punctuation">:</span><span class="token boolean">False</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>通过绘制直方图和核密度曲线图，用于检验数据是否近似服从正态分布，进而选择一个最终的异常值判别方法</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 导入绘图模块</span>
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token comment"># 设置绘图风格</span>
plt<span class="token punctuation">.</span>style<span class="token punctuation">.</span>use<span class="token punctuation">(</span><span class="token string">'ggplot'</span><span class="token punctuation">)</span>
<span class="token comment"># 绘制直方图</span>
sunspots<span class="token punctuation">.</span>counts<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>kind <span class="token operator">=</span> <span class="token string">'hist'</span><span class="token punctuation">,</span> bins <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">,</span> normed <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token comment"># 绘制核密度图</span>
sunspots<span class="token punctuation">.</span>counts<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>kind <span class="token operator">=</span> <span class="token string">'kde'</span><span class="token punctuation">)</span>
<span class="token comment"># 图形展现</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/Eliauk-L/blog-img@img/img/202408012224347.png" alt="直方图和核密度曲线"></p>
<p>不管是直方图还是核密度曲线，所呈现的数据分布形状都是有偏的，并且属于右偏。基于此，这里选择箱线图法来判定那些异常值。</p>
<p>使用替换法来处理异常值，即使用低于判别上限的最大值或高于判别下限的最小值替换</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#替换法处理异常值</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'异常值替换前的数据统计特征:\n '</span><span class="token punctuation">,</span>sunspots<span class="token punctuation">.</span>counts<span class="token punctuation">.</span>describe<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#箱线图中的异常值判别上限</span>
UL<span class="token operator">=</span> Q3 <span class="token operator">+</span> <span class="token number">1.5</span> <span class="token operator">*</span> IQR
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'判别异常值的上限临界值:\n '</span> <span class="token punctuation">,</span>UL<span class="token punctuation">)</span>
<span class="token comment">#从数据中找出低于判别上限的最大值</span>
replace_value <span class="token operator">=</span> sunspots<span class="token punctuation">.</span>counts<span class="token punctuation">[</span>sunspots<span class="token punctuation">.</span>counts <span class="token operator">&lt;</span> UL<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'用以替换异常值的数据:n'</span><span class="token punctuation">,</span>replace_value<span class="token punctuation">)</span>
<span class="token comment">#替换超过判别上限异常值</span>
sunspots<span class="token punctuation">.</span>counts<span class="token punctuation">[</span>sunspots<span class="token punctuation">.</span>counts <span class="token operator">&gt;</span> UL<span class="token punctuation">]</span> <span class="token operator">=</span> replace_value
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'异常值替换后的数据统计特征:\n '</span><span class="token punctuation">,</span>sunspots<span class="token punctuation">.</span>counts<span class="token punctuation">.</span>describe<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
out<span class="token punctuation">:</span>
判别异常值的上限临界值<span class="token punctuation">:</span><span class="token number">148.85</span>
用以替换异常值的数据<span class="token punctuation">:</span><span class="token number">141.7</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="数据子集的获取"><a href="#数据子集的获取" class="headerlink" title="数据子集的获取"></a>数据子集的获取</h2><ul>
<li><p>在 Pandas 模块中实现数据框子集的获取可以使用<code>iloc</code>、<code>loc</code>和<code>ix</code>三种“方法”，这三种方法既可以对数据行进行筛选，也可以实现变量的挑选，它们的语法可以表示成<code>[rows_select,cols_select]</code>。</p>
<ul>
<li><code>iloc</code>只能通过<strong>行号和列号</strong>进行数据的筛选，读者可以将 iloc 中的“i”理解为“integer”，即只能向[rows_select, cols_select]指定<strong>整数列表</strong>。该索引方式与数组的索引方式类似，都是从 0 开始，可以间隔取号，对于切片仍然无法取到上限。</li>
<li><code>loc</code>要比 iloc 灵活一些，读者可以将 loc 中的“l”理解为“label”，即可以向[rows_select, cols_select]指定具体的<strong>行标签（行名称）和列标签（字段名）</strong>。注意，这里是标签不再是索引。而且，还可以将 rows_select 指定为具体的筛选条件，在 iloc 中是无法做到的。</li>
<li><code>ix</code>是 iloc 和 loc 的混合，该“方法”吸收了 iloc 和 loc 的优点，使数据框子集的获取更加灵活。</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#构造数据集</span>
df1 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>
    <span class="token punctuation">{</span>
        <span class="token string">'name'</span> <span class="token punctuation">:</span><span class="token punctuation">[</span> <span class="token string">'张三'</span><span class="token punctuation">,</span><span class="token string">'李四'</span><span class="token punctuation">,</span><span class="token string">'王二'</span><span class="token punctuation">,</span><span class="token string">'丁一'</span><span class="token punctuation">,</span><span class="token string">'李五'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'gender'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'男'</span><span class="token punctuation">,</span><span class="token string">'女'</span><span class="token punctuation">,</span><span class="token string">'女'</span><span class="token punctuation">,</span><span class="token string">'女'</span><span class="token punctuation">,</span><span class="token string">'男'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'age'</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">23</span><span class="token punctuation">,</span><span class="token number">26</span><span class="token punctuation">,</span><span class="token number">22</span><span class="token punctuation">,</span><span class="token number">25</span><span class="token punctuation">,</span><span class="token number">27</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    columns <span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'name '</span> <span class="token punctuation">,</span> <span class="token string">'gender'</span><span class="token punctuation">,</span><span class="token string">'age'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
df1
<span class="token comment">#取出数据集的中间三行(即所有女性)，并且返回姓名和年龄两列</span>
df1<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>l<span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
df1<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'age'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
df1<span class="token punctuation">.</span>ix<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/Eliauk-L/blog-img@img/img/202408012224735.png" alt="数据子集的获取结果"></p>
</li>
<li><p>假如数据集没有行号，而是具体的行名称,使用这三种方法实现中间三行数据的获取</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 将员工的姓名用作行标签</span>
df2 <span class="token operator">=</span> df1<span class="token punctuation">.</span>set_index<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span>
df2
<span class="token comment"># 取出数据集的中间三行</span>
df2<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
df2<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'李四'</span><span class="token punctuation">,</span><span class="token string">'王二'</span><span class="token punctuation">,</span><span class="token string">'丁一'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
df2<span class="token punctuation">.</span>ix<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/Eliauk-L/blog-img@img/img/202408012224913.png" alt="数据子集的获取结果"></p>
<p>对于 iloc 来说，不管什么形式的数据集都可以使用，始终表示行索引，即取哪些行下标的观测；loc 就不能使用数值表示行标签了，因为此时数据集的行标签是姓名，所以需要写入中间三行对应的姓名；通过 ix 方法，既可以用行索引（如代码所示）表示，也可以用行标签表示</p>
</li>
<li><p>筛选条件</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 使用筛选条件，取出所有男性的姓名和年龄</span>
<span class="token comment"># df1.iloc[df1.gender == '男',] 无法使用</span>
df1<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>df1<span class="token punctuation">.</span>gender <span class="token operator">==</span> <span class="token string">'男'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">,</span><span class="token string">'age'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
df1<span class="token punctuation">.</span>ix<span class="token punctuation">[</span>df1<span class="token punctuation">.</span>gender <span class="token operator">==</span> <span class="token string">'男'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">,</span><span class="token string">'age'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/Eliauk-L/blog-img@img/img/202408012224723.png" alt="数据子集的获取结果"></p>
</li>
</ul>
<h2 id="透视表功能"><a href="#透视表功能" class="headerlink" title="透视表功能"></a>透视表功能</h2><ul>
<li><p>数据的汇总统计。例如，按照某个分组变量统计商品的平均价格、销售数量、最大利润等，或者按照某两个分组变量构成统计学中的列联表（计数统计），甚至是基于多个分组变量统计各组合下的均值、中位数、总和等。</p>
</li>
<li><p><strong><code>pd.pivot_table(data, values=None, index=None, columns=None, aggfunc= 'mean', fill_value=None, margins=False, dropna=True, margins_name='All')</code></strong></p>
<ul>
<li><strong>data</strong>：指定需要构造透视表的数据集。</li>
<li><strong>values</strong>：指定需要拉入“数值”框的字段列表。</li>
<li><strong>index</strong>：指定需要拉入“行标签”框的字段列表。</li>
<li><strong>columns</strong>：指定需要拉入“列标签”框的字段列表。</li>
<li><strong>aggfunc</strong>：指定数值的统计函数，默认为统计均值，也可以指定 numpy 模块中的其他统计函数。</li>
<li><strong>fill_value</strong>：指定一个标量，用于填充缺失值。</li>
<li><strong>margins</strong>：bool 类型参数，是否需要显示行或列的总计值，默认为 False。</li>
<li><strong>dropna</strong>：bool 类型参数，是否需要删除整列为缺失的字段，默认为 True。</li>
<li><strong>margins_name</strong>：指定行或列的总计名称，默认为 All。</li>
</ul>
</li>
<li><p>单个分组变量的均值统计</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 数据读取</span>
diamonds <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_table<span class="token punctuation">(</span><span class="token string">r'C:\Users\Administrator\Desktop\diamonds.csv'</span><span class="token punctuation">,</span> sep <span class="token operator">=</span> <span class="token string">','</span><span class="token punctuation">)</span>
<span class="token comment"># 单个分组变量的均值统计  不同颜色的价格汇总</span>
pd<span class="token punctuation">.</span>pivot_table<span class="token punctuation">(</span>
    data <span class="token operator">=</span> diamonds<span class="token punctuation">,</span>
    index <span class="token operator">=</span> <span class="token string">'color'</span><span class="token punctuation">,</span>
    values <span class="token operator">=</span> <span class="token string">'price'</span><span class="token punctuation">,</span>
    margins <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">,</span>
    margins_name <span class="token operator">=</span> <span class="token string">'总计'</span><span class="token punctuation">)</span>
<span class="token comment"># 返回结果属于Pandas模块中的序列类型</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/Eliauk-L/blog-img@img/img/202408012224823.png" alt="Python的透视表结果"></p>
</li>
<li><p>构造两个分组变量的列联表</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#两个分组变量的列联表</span>
<span class="token comment">#导入numpy模块</span>
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
pd<span class="token punctuation">.</span>pivot_table<span class="token punctuation">(</span>
    data <span class="token operator">=</span> diamonds<span class="token punctuation">,</span>
    index <span class="token operator">=</span> <span class="token string">'clarity'</span><span class="token punctuation">,</span>
    columns <span class="token operator">=</span> <span class="token string">'cut '</span><span class="token punctuation">,</span>
    values <span class="token operator">=</span> <span class="token string">'carat'</span><span class="token punctuation">,</span>
    aggfunc <span class="token operator">=</span> np<span class="token punctuation">.</span>size<span class="token punctuation">,</span>
    margins <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">,</span>
    margins_name <span class="token operator">=</span> <span class="token string">'总计'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/Eliauk-L/blog-img@img/img/202408012224205.png" alt="Python的透视表结果"></p>
<p>对于列联表来说，行和列都需要指定某个分组变量，所以 index 参数和 columns 参数都需要指定一个分组变量，并且统计的不再是某个变量的均值，而是观测个数，所以 aggfunc 参数需要指定 numpy 模块中的 size 函数。通过这样的参数设置，返回的是一个数据框对象。</p>
</li>
</ul>
<h2 id="表之间的合并与连接"><a href="#表之间的合并与连接" class="headerlink" title="表之间的合并与连接"></a>表之间的合并与连接</h2><ul>
<li><p>对于多表之间的纵向合并，必须确保多表的列数和数据类型一致；对于多表之间的水平扩展，必须保证多表要有共同的匹配字段</p>
</li>
<li><p>Pandas 模块同样提供了关于多表之间的合并和连接操作函数，分别是<code>concat</code>函数和<code>merge</code>函数</p>
<ul>
<li><p>合并函数 concat：<strong><code>pd.concat(objs, axis=0, join='outer', join_axes=None, ignore_index=False, keys=None)</code></strong></p>
<ul>
<li><strong>objs</strong>：指定需要合并的对象，可以是序列、数据框或面板数据构成的列表。</li>
<li><strong>axis</strong>：指定数据合并的轴，默认为 0，表示合并多个数据的行，如果为 1，就表示合并多个数据的列。</li>
<li><strong>join</strong>：指定合并的方式，默认为 outer，表示合并所有数据，如果改为 inner，表示合并公共部分的数据。</li>
<li><strong>join_axes</strong>：合并数据后，指定保留的数据轴。</li>
<li><strong>ignore_index</strong>：bool 类型的参数，表示是否忽略原数据集的索引，默认为 False，如果设为 True，就表示忽略原索引并生成新索引。</li>
<li><strong>keys</strong>：为合并后的数据添加新索引，用于区分各个数据部分。</li>
</ul>
</li>
<li><p>如果纵向合并多个数据集，即使这些数据集都含有“姓名”变量，但变量名称不一致，如 Name 和 name，通过合并后，将会得到错误的结果。</p>
</li>
<li><p>join_axes 参数的使用，例如纵向合并两个数据集 df1 和 df2，可以写成<code>pd.concat([df1,df2])</code>，如果该参数等于<code>[df1.index]</code>，就表示保留与 df1 行标签一样的数据，但需要配合 axis=1 一起使用；如果等于<code>[df1.columns]</code>，就保留与 df1 列标签一样的数据，但不需要添加 axis=1 的约束。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#构造数据集df1和 df2</span>
df1 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>
    <span class="token punctuation">{</span>
        <span class="token string">'name'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'张三'</span><span class="token punctuation">,</span><span class="token string">'李四'</span><span class="token punctuation">,</span><span class="token string">'王二'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'age'</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">21</span><span class="token punctuation">,</span><span class="token number">25</span><span class="token punctuation">,</span><span class="token number">22</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'gender'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'男'</span><span class="token punctuation">,</span><span class="token string">'女'</span><span class="token punctuation">,</span><span class="token string">'男'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
df2<span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame <span class="token punctuation">(</span>
    <span class="token punctuation">{</span>
        <span class="token string">'name'</span> <span class="token punctuation">:</span><span class="token punctuation">[</span> <span class="token string">'丁一'</span><span class="token punctuation">,</span><span class="token string">'赵五'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'age'</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">23</span><span class="token punctuation">,</span><span class="token number">22</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'gender '</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token string">'女'</span> <span class="token punctuation">,</span><span class="token string">'女'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">#数据集的纵向合并</span>
pd<span class="token punctuation">.</span>concat<span class="token punctuation">(</span><span class="token punctuation">[</span>df1<span class="token punctuation">,</span>df2<span class="token punctuation">]</span> <span class="token punctuation">,</span> keys <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'df1'</span><span class="token punctuation">,</span> <span class="token string">'df2 '</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">#如果df2数据集中的“姓名变量为Name”</span>
df2 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame <span class="token punctuation">(</span>
    <span class="token punctuation">{</span>
        <span class="token string">'Name '</span> <span class="token punctuation">:</span><span class="token punctuation">[</span> <span class="token string">'丁一'</span><span class="token punctuation">,</span><span class="token string">'赵五'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'age'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">23</span><span class="token punctuation">,</span><span class="token number">22</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'gender '</span> <span class="token punctuation">;</span> <span class="token punctuation">[</span> <span class="token string">'女'</span><span class="token punctuation">,</span><span class="token string">'女'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">#数据集的纵向合并</span>
pd<span class="token punctuation">.</span>concat <span class="token punctuation">(</span><span class="token punctuation">[</span>df1<span class="token punctuation">,</span>df2<span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/Eliauk-L/blog-img@img/img/202408012224703.png" alt="数据的合并结果"></p>
</li>
<li><p>连接函数 merge： <code>pd.merge(left, right, how='inner', on=None, left_on=None, right_on=None,left_index=False, right_index=False, sort=False, suffixes=('_x', '_y'))</code></p>
<ul>
<li><strong>left</strong>：指定需要连接的主表。</li>
<li><strong>right</strong>：指定需要连接的辅表。</li>
<li><strong>how</strong>：指定连接方式，默认为 inner 内连，还有其他选项，如左连 left、右连 right 和外连 outer。</li>
<li><strong>on</strong>：指定连接两张表的共同字段。</li>
<li><strong>left_on</strong>：指定主表中需要连接的共同字段。</li>
<li><strong>right_on</strong>：指定辅表中需要连接的共同字段。</li>
<li><strong>left_index</strong>：bool 类型参数，是否将主表中的行索引用作表连接的共同字段，默认为 False。</li>
<li><strong>right_index</strong>：bool 类型参数，是否将辅表中的行索引用作表连接的共同字段，默认为 False。</li>
<li><strong>sort</strong>：bool 类型参数，是否对连接后的数据按照共同字段排序，默认为 False。</li>
<li><strong>suffixes</strong>：如果数据连接的结果中存在重叠的变量名，则使用各自的前缀进行区分。</li>
</ul>
</li>
<li><p>该函数的最大缺点是，每次只能操作两张数据表的连接，如果有 n 张表需要连接，则必须经过 n-1 次的 merge 函数使用。</p>
</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#构造数据集</span>
df3 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame <span class="token punctuation">(</span>
    <span class="token punctuation">{</span>
        <span class="token string">'id'</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token punctuation">,</span>
        <span class="token string">'name '</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token string">'张三'</span><span class="token punctuation">,</span> <span class="token string">'李四'</span><span class="token punctuation">,</span><span class="token string">'王二'</span><span class="token punctuation">,</span><span class="token string">'丁一'</span><span class="token punctuation">,</span><span class="token string">'赵五'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'age'</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">27</span><span class="token punctuation">,</span><span class="token number">24</span><span class="token punctuation">,</span><span class="token number">25</span><span class="token punctuation">,</span><span class="token number">23</span><span class="token punctuation">,</span><span class="token number">25</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'gender'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'男'</span><span class="token punctuation">,</span><span class="token string">'男'</span><span class="token punctuation">,</span><span class="token string">'男'</span><span class="token punctuation">,</span><span class="token string">'女'</span><span class="token punctuation">,</span><span class="token string">'女'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
df4 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame <span class="token punctuation">(</span>
    <span class="token punctuation">{</span>
        <span class="token string">'Id'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'score'</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token number">83</span><span class="token punctuation">,</span><span class="token number">81</span><span class="token punctuation">,</span><span class="token number">87</span><span class="token punctuation">,</span><span class="token number">75</span><span class="token punctuation">,</span><span class="token number">86</span><span class="token punctuation">,</span><span class="token number">74</span><span class="token punctuation">,</span><span class="token number">88</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'kemu'</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'科目1'</span><span class="token punctuation">,</span><span class="token string">'科目1'</span><span class="token punctuation">,</span><span class="token string">'科目2'</span><span class="token punctuation">,</span><span class="token string">'科目1'</span><span class="token punctuation">,</span><span class="token string">'科目2 '</span><span class="token punctuation">,</span><span class="token string">'科目3'</span><span class="token punctuation">,</span><span class="token string">'科目1'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
df5 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>
    <span class="token punctuation">{</span>
        <span class="token string">'id'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">' name'</span> <span class="token punctuation">:</span><span class="token punctuation">[</span> <span class="token string">'张三'</span><span class="token punctuation">,</span><span class="token string">'王二'</span><span class="token punctuation">,</span><span class="token string">'赵五'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'income'</span> <span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">13500</span><span class="token punctuation">,</span><span class="token number">18000</span><span class="token punctuation">,</span><span class="token number">15000</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">#三表的数据连接</span>
<span class="token comment">#首先df3和 df4连接</span>
mergel <span class="token operator">=</span> pd<span class="token punctuation">.</span>merge <span class="token punctuation">(</span>
    left <span class="token operator">=</span> df3<span class="token punctuation">,</span>
    right <span class="token operator">=</span> df4<span class="token punctuation">,</span>
    how <span class="token operator">=</span> <span class="token string">'left'</span><span class="token punctuation">,</span>
    left_on<span class="token operator">=</span><span class="token string">'id'</span><span class="token punctuation">,</span>
    right_on<span class="token operator">=</span><span class="token string">'Id'</span><span class="token punctuation">)</span>
mergel
<span class="token comment">#再将连接结果与df5连接</span>
merge2 <span class="token operator">=</span> pd<span class="token punctuation">.</span>merge<span class="token punctuation">(</span>
    left <span class="token operator">=</span> mergel<span class="token punctuation">,</span>
    right <span class="token operator">=</span> df5<span class="token punctuation">,</span>
    how <span class="token operator">=</span> <span class="token string">'left '</span><span class="token punctuation">)</span>
merge2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/Eliauk-L/blog-img@img/img/202408012224161.png" alt="数据的连接结果"></p>
</li>
</ul>
<h2 id="分组聚合操作"><a href="#分组聚合操作" class="headerlink" title="分组聚合操作"></a>分组聚合操作</h2><ul>
<li>根据某些分组变量，对数值型变量进行分组统计。</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#通过groupby方法，指定分组变量</span>
grouped <span class="token operator">=</span> diamonds<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span>by <span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'color'</span> <span class="token punctuation">,</span> <span class="token string">'cut'</span> <span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">#对分组变量进行统计汇总</span>
result <span class="token operator">=</span> grouped<span class="token punctuation">.</span>aggregate <span class="token punctuation">(</span>
    <span class="token punctuation">{</span>
        <span class="token string">'color'</span> <span class="token punctuation">:</span> np<span class="token punctuation">.</span>size<span class="token punctuation">,</span>
        <span class="token string">'carat'</span> <span class="token punctuation">:</span> np<span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">,</span>
        <span class="token string">'price'</span> <span class="token punctuation">:</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">,</span>
        <span class="token string">'face_width'</span> <span class="token punctuation">:</span> np<span class="token punctuation">.</span><span class="token builtin">max</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
result
<span class="token comment">#调整变量名的顺序</span>
result <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>
    result<span class="token punctuation">,</span>
    columns<span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'color'</span><span class="token punctuation">,</span><span class="token string">' carat'</span><span class="token punctuation">,</span><span class="token string">'price'</span> <span class="token string">'face_width'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
result
<span class="token comment">#数据集重命名</span>
result<span class="token punctuation">.</span>rename<span class="token punctuation">(</span>
    columns<span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">'color'</span> <span class="token punctuation">:</span> <span class="token string">'counts'</span> <span class="token punctuation">,</span>
        <span class="token string">'carat'</span> <span class="token punctuation">:</span> <span class="token string">'min_weight'</span> <span class="token punctuation">,</span>
        <span class="token string">'price'</span> <span class="token punctuation">:</span> <span class="token string">'avg price'</span><span class="token punctuation">,</span>
        <span class="token string">'face_width'</span> <span class="token punctuation">:</span> <span class="token string">'max_face_width'</span><span class="token punctuation">}</span> <span class="token punctuation">,</span>
    inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
result
<span class="token comment">#将行索引转换为数据框的变量</span>
result<span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
result<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/Eliauk-L/blog-img@img/img/202408012224342.png" alt="聚合操作结果"></p>
<ul>
<li>使用 Pandas 实现分组聚合需要分两步走<ul>
<li>第一步是指定分组变量，可以通过数据框的 groupby“方法”完成；</li>
<li>第二步是对不同的数值变量计算各自的统计值。必须以字典的形式控制变量名称和统计函数。</li>
</ul>
</li>
</ul>
<blockquote>
<p><strong>参考：</strong></p>
<ol>
<li>从零开始学 Python 数据分析与挖掘／刘顺祥著．北京：清华大学出版社，2018</li>
</ol>
</blockquote>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">Jay</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="http://Eliauk-L.github.io/2024/08/01/pandas-xue-xi/">http://Eliauk-L.github.io/2024/08/01/pandas-xue-xi/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">Jay</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/%E7%AC%94%E8%AE%B0/">
                                    <span class="chip bg-color">笔记</span>
                                </a>
                            
                                <a href="/tags/Python/">
                                    <span class="chip bg-color">Python</span>
                                </a>
                            
                                <a href="/tags/Pandas/">
                                    <span class="chip bg-color">Pandas</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="qq, qzone, wechat, weibo, douban" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
        </div>
    </div>

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2024/08/02/javase-si-wei-dao-tu/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/34.jpg" class="responsive-img" alt="JAVASE思维导图">
                        
                        <span class="card-title">JAVASE思维导图</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2024-08-02
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Java/" class="post-category">
                                    Java
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Java/">
                        <span class="chip bg-color">Java</span>
                    </a>
                    
                    <a href="/tags/%E6%80%9D%E7%BB%B4%E5%AF%BC%E5%9B%BE/">
                        <span class="chip bg-color">思维导图</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2024/08/01/vectorcalculus/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/22.jpg" class="responsive-img" alt="Vector Calculus">
                        
                        <span class="card-title">Vector Calculus</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2024-08-01
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Mathematics/" class="post-category">
                                    Mathematics
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Mathematics/">
                        <span class="chip bg-color">Mathematics</span>
                    </a>
                    
                    <a href="/tags/%E7%AC%94%E8%AE%B0/">
                        <span class="chip bg-color">笔记</span>
                    </a>
                    
                    <a href="/tags/VectorCalculus/">
                        <span class="chip bg-color">VectorCalculus</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>


  <!-- 是否加载使用自带的 prismjs. -->
  <script type="text/javascript" src="/libs/prism/prism.min.js"></script>


<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>



    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>


<script src="https://cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script>
    MathJax.Hub.Config({
        tex2jax: {inlineMath: [['$', '$'], ['\\(', '\\)']]}
    });
</script>



    <footer class="page-footer bg-color">
    

    <div class="container row center-align"
         style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2024</span>
            
            <a href="/about" target="_blank">Jay</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            
            <br>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/Eliauk-L" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:2571368706@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=2571368706" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 2571368706" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 白天和黑夜主题 -->
<div class="stars-con">
    <div id="stars"></div>
    <div id="stars2"></div>
    <div id="stars3"></div>  
</div>

<script>
    function switchNightMode() {
        $('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($('body')),
        setTimeout(function () {
            $('body').hasClass('DarkMode') 
            ? ($('body').removeClass('DarkMode'), localStorage.setItem('isDark', '0'), $('#sum-moon-icon').removeClass("fa-sun").addClass('fa-moon')) 
            : ($('body').addClass('DarkMode'), localStorage.setItem('isDark', '1'), $('#sum-moon-icon').addClass("fa-sun").removeClass('fa-moon')),
            
            setTimeout(function () {
            $('.Cuteen_DarkSky').fadeOut(1e3, function () {
                $(this).remove()
            })
            }, 2e3)
        })
    }
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    

    
    
    

    <!-- 雪花特效 -->
     
        <script type="text/javascript">
            // 只在桌面版网页启用特效
            var windowWidth = $(window).width();
            if (windowWidth > 768) {
                document.write('<script type="text/javascript" src="/libs/others/snow.js"><\/script>');
            }
        </script>
    

    <!-- 鼠标星星特效 -->
    

    

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
